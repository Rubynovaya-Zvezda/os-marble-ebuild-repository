From 45e4a19d803165fac878af675c399f8bcce2883a Mon Sep 17 00:00:00 2001
From: danilanosikov <danilanosikov@yandex.ru>
Date: Wed, 25 Sep 2024 17:44:50 +0300
Subject: [PATCH 1/2] Addition of OpenRC Support

---
 Makefile                           | 16 ++++++++++++++--
 keyd.openrc.in                     |  8 ++++++++
 keyd.service.in => keyd.systemd.in |  0
 3 files changed, 22 insertions(+), 2 deletions(-)
 create mode 100644 keyd.openrc.in
 rename keyd.service.in => keyd.systemd.in (100%)

diff --git a/Makefile b/Makefile
index f600179..a92263d 100644
--- a/Makefile
+++ b/Makefile
@@ -49,13 +49,24 @@ man:
 install:
 
 	@if [ -e /run/systemd/system ]; then \
-		sed -e 's#@PREFIX@#$(PREFIX)#' keyd.service.in > keyd.service; \
+		sed -e 's#@PREFIX@#$(PREFIX)#' keyd.systemd.in > keyd.service; \
 		mkdir -p $(DESTDIR)$(PREFIX)/lib/systemd/system/; \
 		install -Dm644 keyd.service $(DESTDIR)$(PREFIX)/lib/systemd/system/keyd.service; \
 	else \
-		echo "NOTE: systemd not found, you will need to manually add keyd to your system's init process."; \
+		echo "NOTE: systemd not found."; \
 	fi
 
+	@if [ -e /run/openrc ]; then \
+		cp keyd.openrc.in keyd.rc; \
+		chmod +x keyd.rc; \
+		mv keyd.rc /etc/init.d/keyd; \
+	else \
+		echo "NOTE: openrc not found."; \
+		echo "NOTE: you will need to add keyd to your init proccess manually."; \
+	fi
+
+		
+
 	@if [ "$(VKBD)" = "usb-gadget" ]; then \
 		sed -e 's#@PREFIX@#$(PREFIX)#' src/vkbd/usb-gadget.service.in > src/vkbd/usb-gadget.service; \
 		install -Dm644 src/vkbd/usb-gadget.service $(DESTDIR)$(PREFIX)/lib/systemd/system/keyd-usb-gadget.service; \
@@ -82,6 +93,7 @@ install:
 uninstall:
 	-groupdel keyd
 	rm -rf $(DESTDIR)$(PREFIX)/lib/systemd/system/keyd.service \
+		/etc/init.d/keyd \
 		$(DESTDIR)$(PREFIX)/bin/keyd \
 		$(DESTDIR)$(PREFIX)/bin/keyd-application-mapper \
 		$(DESTDIR)$(PREFIX)/share/doc/keyd/ \
diff --git a/keyd.openrc.in b/keyd.openrc.in
new file mode 100644
index 0000000..4a8d68b
--- /dev/null
+++ b/keyd.openrc.in
@@ -0,0 +1,8 @@
+#!/sbin/openrc-run
+
+name="keyd"
+description="key remapping daemon"
+command="keyd"
+command_background=true
+command_user=root:root
+pidfile="/run/keyd.pid"
diff --git a/keyd.service.in b/keyd.systemd.in
similarity index 100%
rename from keyd.service.in
rename to keyd.systemd.in
-- 
2.45.2

